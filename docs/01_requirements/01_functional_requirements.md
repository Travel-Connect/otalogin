# 機能要件

## 概要

OTA（Online Travel Agency）自動ログイン支援ツール。
Chrome拡張 + 社内Webポータルで、複数のOTAサイトへのログインを自動化する。

## ユーザー

- 利用者: 5名（Windows 11、Chrome固定）
- 認証: メール + パスワード（Supabase Auth）

## MVP対象OTA

1. 楽天トラベル
2. じゃらん
3. ねっぱん

## 機能一覧

### F1: ユーザー認証

- メール + パスワードでログイン
- ログアウト機能
- セッション管理（Supabase SSR）

### F2: 施設管理

- 施設一覧表示（カード形式）
- 施設カード右上に歯車アイコン（メニュー）
- 施設詳細画面
  - 施設情報の編集
  - チャネル（OTA）ごとの設定

### F3: チャネルアカウント管理

- 各施設 × 各チャネルごとにアカウント情報を管理
- shared（共通）と override（個別上書き）の2種類
- パスワード表示
  - デフォルトは `****` でマスク
  - 目アイコンクリックで表示
  - 10秒で自動的にマスク復帰
- 追加フィールド定義
  - チャネルごとに異なる追加項目（施設コード等）を定義可能

### F4: マスタPW同期

- Google Sheets の共通マスタPWシートから同期
- 同期ボタンはチャネル単位
- 同期対象は「今開いているチャネル（facility × channel）」のみ
- 実行前に確認ダイアログを表示
- Enter キーで実行可能

### F5: 手動ログイン実行

- ポータルから「ログイン実行」ボタンを押す
- Chrome拡張が同じウィンドウ内に新しいタブを開く
  - **別ウィンドウや別インスタンスの起動は NG**
- 拡張がID/PWを入力してログイン
- 結果をポータルに報告

### F6: Health Check（自動ログインテスト）

- 毎日 05:00 JST（= 20:00 UTC）に実行
- 対象: shared アカウントのみ（override は対象外）
- 各チャネルのログイン成否を記録
- 状態ランプで可視化
  - 緑: 最後の Health Check 成功
  - 赤: 最後の Health Check 失敗

### F7: 状態表示

- 施設カード / チャネルタイル右上に状態ランプ
- 緑 / 赤 でログイン状態を視覚化

## 画面構成

### /login

- メール + パスワード入力
- ログインボタン

### / （ホーム / 施設一覧）

- 施設カード一覧
- カード右上: 歯車アイコン（メニュー）
- カード: 状態ランプ表示

### /facility/[facilityId]

- 施設情報表示
- チャネルタブ / タイル
  - 各チャネルのアカウント設定
  - 状態ランプ
  - ログイン実行ボタン
  - マスタPW同期ボタン
  - パスワード表示（目アイコン + 10秒マスク）

## 非機能要件

### セキュリティ

- パスワードは平文で拡張に保存しない
- ログ / 成果物に機密情報を出力しない
- RLS でデータアクセスを制御

### 運用

- 5名での同時利用に対応
- Windows 11 + Chrome 環境

## 制約

- Chrome 拡張は Manifest V3
- Vercel Cron はタイムゾーン UTC 固定
- Supabase は @supabase/ssr を使用
